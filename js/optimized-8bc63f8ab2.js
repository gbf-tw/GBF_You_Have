!function(){"use strict";angular.module("OwnershipRatio",["ngAnimate","ngResource","ngTouch","ui.bootstrap","ui.router"])}(),function(){"use strict";function e(e,a,r,n,t,l,s,o){function i(){t.debug("activate"),w.init()}function u(e){var a=0,r={},n=0;return angular.forEach(w.constants.elements,function(e){r[e.key]=n,++n}),a*=n,a+=r[e.element],r={},n=0,angular.forEach(w.constants.types,function(e){r[e.key]=n,++n}),a*=n,a+=r[e.type],r={},n=0,angular.forEach(w.constants.genders,function(e){r[e.key]=n,++n}),a*=n,a+=r[e.gender]}function c(){if(t.debug("hrefTweet"),null===w.charaIds||null===w.charas)return t.debug("vm.charaIds === null || vm.charas === null"),"";var e="レジェンドガチャの"+w.rarerity.value+"キャラ所有率は"+a("number")(w.ownership.rate,0)+"％です。["+w.ownership.selected+"/"+w.ownership.all+"]",r="（恒常："+a("number")(w.ownership.normalRate,0)+"% ["+w.ownership.normalSelected+"/"+w.ownership.normalAll+"]、限定："+a("number")(w.ownership.specialRate,0)+"% ["+w.ownership.specialSelected+"/"+w.ownership.specialAll+"]）",n=w.charaIds.length;n%4!==0&&(n=4*Math.floor(n/4)+4);var l,s="",o=0;if(w.charaIds&&w.charaIds.length)for(l=0;n>l;l++){if(o*=2,l<w.charaIds.length){var i=w.charaIds[l];w.ownership.chara[i]&&(o+=1)}if(l%4===3){var u="0"+o.toString(16);u=u.slice(-1),s+=""+u,o=0}}return"https://twitter.com/intent/tweet?source=webclient&text="+encodeURIComponent(e)+"%0a"+encodeURIComponent(r)+"&url="+encodeURIComponent("https://gbf-tw.github.io/GBF_You_Have/#/chara?"+w.rarerity.key+"="+s)+"&hashtags="+encodeURIComponent("グラブルキャラ所有率")}function h(){t.debug("init"),w.rarerity||(void 0!==o.ssr?w.rarerity=e.rarerities[0]:void 0!==o.sr?w.rarerity=e.rarerities[1]:void 0!==o.r?w.rarerity=e.rarerities[2]:w.rarerity=e.rarerities[0]),w.charas=null;var a=r.query({filename:w.rarerity.key+"-charas.json"}).$promise.then(function(e){t.debug("charaRsc success"),t.debug(e),w.charas=e},function(e){t.debug("charaRsc failure"),t.debug(e)});w.charaIds=null;var n=r.query({filename:w.rarerity.key+"-chara-ids.json"}).$promise.then(function(e){t.debug("charaIdsRsc success"),t.debug(e),w.charaIds=e},function(e){t.debug("charaIdsRsc failure"),t.debug(e)});l.all([a,n])["finally"](w.initView)}function m(){return t.debug("initView"),null===w.charaIds||null===w.charas?void t.debug("vm.charaIds === null || vm.charas === null"):(w.loadOwnership(),w.updateFilteredCharas(),w.normalCharas=a("filter")(w.charas,{kind:"normal"},!0),void w.updateOwnership())}function v(){var e=o[w.rarerity.key];if("ssr"===w.rarerity.key&&o.ssr_chara&&(e=o.ssr_chara),e){var a=e.split(""),r=0;angular.forEach(a,function(e){var a=parseInt(e,16),n="0000"+a.toString(2);n=n.slice(-4);for(var t=n.split(""),l=0;l<t.length;r++,l++)if(r<w.charaIds.length&&"1"===n[l]){var s=w.charaIds[r];w.ownership.chara[s]=!0}})}}function f(){angular.forEach(w.filteredCharas,function(e){w.ownership.chara[e.id]=!1})}function d(){angular.forEach(w.filteredCharas,function(e){w.ownership.chara[e.id]=!0})}function p(){t.debug("updateFilteredCharas"),w.filteredCharas=a("charaFilter")(w.charas,w.filter)}function g(){if(t.debug("updateOwnership"),null===w.charaIds||null===w.charas)return void t.debug("vm.charaIds === null || vm.charas === null");w.ownership.all=w.charas.length,w.ownership.normalAll=a("filter")(w.charas,{kind:"normal"},!0).length,w.ownership.specialAll=w.ownership.all-w.ownership.normalAll;var e=0;angular.forEach(w.charas,function(a){w.ownership.chara[a.id]&&e++}),w.ownership.selected=e,w.ownership.rate=100*w.ownership.selected/w.ownership.all;var r=0;angular.forEach(w.normalCharas,function(e){w.ownership.chara[e.id]&&r++}),w.ownership.normalSelected=r,w.ownership.specialSelected=e-r,w.ownership.normalRate=100*w.ownership.normalSelected/w.ownership.normalAll,w.ownership.specialRate=100*w.ownership.specialSelected/w.ownership.specialAll}var w=this;w.charaIds=null,w.charas=null,w.constants=e,w.ownership={chara:{},all:0,rate:0,selected:0,normalAll:0,normalRate:0,normalSelected:0,specialAll:0,specialRate:0,specialSelected:0},w.filteredCharas=[],w.filter={gender:{},type:{},release:{},kind:{},style:{}},w.isOpenFilter=!1,w.rarerity=null,w.charaSort=u,w.hrefTweet=c,w.init=h,w.initView=m,w.loadOwnership=v,w.onClickReleaseAll=f,w.onClickSelectAll=d,w.updateFilteredCharas=p,w.updateOwnership=g,s.$watch(function(){return w.rarerity},w.init,!0),s.$watch(function(){return w.filter},w.updateFilteredCharas,!0),s.$watch(function(){return w.ownership.chara},w.updateOwnership,!0),i()}e.$inject=["constants","$filter","jsonService","$location","$log","$q","$scope","$stateParams"],angular.module("OwnershipRatio").controller("charaController",e)}(),function(){"use strict";function e(e){return function(e,a){var r=[];return angular.forEach(e,function(e){var n=!0;angular.forEach(a,function(a,r){var t=!0;angular.forEach(a,function(e,a){e&&(t=!1)}),t||a[e[r]]||(n=!1)}),n&&r.push(e)}),r}}e.$inject=["$log"],angular.module("OwnershipRatio").filter("charaFilter",e)}(),function(){"use strict";var e={};e.elements=[{key:"fire",value:"火"},{key:"water",value:"水"},{key:"earth",value:"土"},{key:"wind",value:"風"},{key:"light",value:"光"},{key:"dark",value:"闇"}],e.genders=[{key:"male",value:"男"},{key:"otome",value:"漢女"},{key:"female",value:"女"},{key:"none",value:"不詳"}],e.kinds=[{key:"normal",value:"恒常"},{key:"limited",value:"リミテッド"},{key:"newYear",value:"十二神将"},{key:"valentine",value:"バレンタイン"},{key:"summer",value:"水着"},{key:"helloween",value:"ハロウィン"},{key:"christmas",value:"クリスマス"}],e.types=[{key:"human",value:"ヒューマン"},{key:"erune",value:"エルーン"},{key:"draph",value:"ドラフ"},{key:"harvin",value:"ハーヴィン"},{key:"primal_beast",value:"星晶獣"},{key:"none",value:"不明"}],e.rarerities=[{key:"ssr",value:"SSR"},{key:"sr",value:"SR"},{key:"r",value:"R"}],e.releases=[{key:"sabre",value:"剣"},{key:"dagger",value:"短剣"},{key:"spear",value:"槍"},{key:"axe",value:"斧"},{key:"staff",value:"杖"},{key:"gun",value:"銃"},{key:"melee",value:"格闘"},{key:"bow",value:"弓"},{key:"harp",value:"楽器"},{key:"katana",value:"刀"}],e.styles=[{key:"balanced",value:"バランス"},{key:"attack",value:"攻撃"},{key:"defense",value:"防御"},{key:"heal",value:"回復"},{key:"special",value:"特殊"}],angular.module("OwnershipRatio").value("constants",e)}(),function(){"use strict";function e(e){return e("json/:filename",{filename:"@filename"},{query:{method:"GET",isArray:!0}})}e.$inject=["$resource"],angular.module("OwnershipRatio").service("jsonService",e)}(),function(){"use strict";function e(e,a){function r(){e.debug("activate"),l.init()}function n(){e.debug("init"),l.currentName=a.current.name}function t(){l.isNavbarOpen=!l.isNavbarOpen}var l=this;l.currentName=null,l.isNavbarOpen=!1,l.init=n,l.onToggleNavbar=t,r()}e.$inject=["$log","$state"],angular.module("OwnershipRatio").controller("navController",e)}(),function(){"use strict";function e(e,a){a.otherwise("/chara"),e.state("chara",{url:"/chara?ssr&sr&r&ssr_chara",views:{nav:{templateUrl:"partials/nav.html",controller:"navController as vm"},content:{templateUrl:"partials/chara.html",controller:"charaController as vm"}}}).state("ssr_chara",{url:"/ssr_chara?ssr&sr&r&ssr_chara",views:{nav:{templateUrl:"partials/nav.html",controller:"navController as vm"},content:{templateUrl:"partials/chara.html",controller:"charaController as vm"}}}).state("ssr_stone",{url:"/ssr_stone?ssr&ssr_stone",views:{nav:{templateUrl:"partials/nav.html",controller:"navController as vm"},content:{templateUrl:"partials/summon.html",controller:"summonController as vm"}}}).state("summon",{url:"/summon?ssr&ssr_stone",views:{nav:{templateUrl:"partials/nav.html",controller:"navController as vm"},content:{templateUrl:"partials/summon.html",controller:"summonController as vm"}}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("OwnershipRatio").config(e)}(),function(){"use strict";function e(e,a,r){function n(){g()}function t(){var e="";return angular.forEach(C.summonIds,function(a){e+=C.have[a]}),e}function l(){e({method:"GET",url:"json/all-summon-ids.json"}).then(function(e){e.data&&(C.summonIds=e.data),angular.forEach(C.summonIds,function(e){C.have[e]=0}),k()},function(e){})}function s(){e({method:"GET",url:"json/all-summons.json"}).then(function(e){e.data&&(C.summons=e.data),k()},function(e){})}function o(){var e=0;return angular.forEach(C.summons,function(a){C.have[a.id]>=4&&e++}),e}function i(){var e=0;return angular.forEach(C.summons,function(a){a.limit&&C.have[a.id]>=5&&e++}),e}function u(){var e=0;return angular.forEach(C.summons,function(a){a.limit&&e++}),e}function c(e){var a;return a=C.have[e]>4?"★":"☆"}function h(){var e="-",a="-";return C.summonIds&&C.summonIds.length&&(e=C.summonIds.length,a=Math.round(100*p()/e)+"%"),"レジェンドガチャのSSR召喚石所有率は"+a+"です。["+p()+"/"+e+"]"}function m(){var e="-",a="-",r="-",n="-";return C.summonIds&&C.summonIds.length&&(e=C.summonIds.length,r=Math.round(100*o()/e)+"%"),u()&&(a=u(),n=Math.round(100*i()/a)+"%"),"（3凸以上："+r+" ["+o()+"/"+e+"]、4凸："+n+" ["+i()+"/"+a+"]）"}function v(e,a){var r;return r=C.have[e]>a?"★":"☆"}function f(e){var a;return angular.forEach(C.summons,function(r){r.id===e&&(a=r)}),a}function d(e){var a=[];return angular.forEach(C.summons,function(r){r.element===e&&a.push(r)}),a}function p(){var e=0;return angular.forEach(C.have,function(a){a>0&&e++}),e}function g(){l(),s()}function w(e){var a=f(e);if(a){var r=a.limit?5:4;C.have[e]>=r?C.have[e]=0:C.have[e]++}}function y(){C.isNavbarOpen=!C.isNavbarOpen}function k(){var e;if(r.ssr?e=r.ssr.split(""):r.ssr_stone&&(e=r.ssr_stone.split("")),e){var a=0;angular.forEach(C.summonIds,function(r){e[a]&&(C.have[r]=e[a]),a++})}"true"===r.heart&&(C.heart=!0)}function b(){I(0)}function I(e){angular.forEach(C.summonIds,function(a){if(e>=5){var r=f(a);r.limit?C.have[a]=5:C.have[a]=4}else C.have[a]=e})}function R(){var e=h(),a=m();return"https://twitter.com/intent/tweet?source=webclient&text="+encodeURIComponent(e)+"%0a"+encodeURIComponent(a)+"&url="+encodeURIComponent("https://gbf-tw.github.io/GBF_You_Have/#/summon?ssr="+t()+(C.heart?"&heart="+C.heart:""))+"&hashtags="+encodeURIComponent("グラブル召喚石所有率")}var C=this;C.elements=["fire","water","earth","wind","light","dark"],C.have={},C.heart=!1,C.isNavbarOpen=!1,C.summonIds=[],C.summons=[],C.getSummons=d,C.getLimitStar=c,C.getRateText1=h,C.getRateText2=m,C.getStar=v,C.onClickSummon=w,C.onToggleNavbar=y,C.resetHave=b,C.setAllHave=I,C.tweetLink=R,n()}e.$inject=["$http","$scope","$stateParams"],angular.module("OwnershipRatio").controller("summonController",e)}();